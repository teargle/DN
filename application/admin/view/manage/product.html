<!DOCTYPE html>
<html>
<head>
	<title>Edit Product</title>
	<link rel="stylesheet" href="__CSS__/bootstrap.min.css">
	<link rel="stylesheet" href="__CSS__/trumbowyg.min.css">
	<link rel="stylesheet" href="__CSS__/manage.index.css">
	<script type="text/javascript" src="__JS__/jquery.min.js"></script>
	<script type="text/javascript" src="__JS__/bootstrap.min.js"></script>
	<script type="text/javascript" src="__JS__/trumbowyg.min.js"></script>
	<script type="text/javascript" src="__JS__/manage.index.js"></script>
	 <style>
        fieldset {
            padding: .35em .625em .75em;
            margin: 0 2px;
            border: 1px solid silver;
        }

        legend {
            padding: .5em;
            border: 0;
            width: auto;
        }
    </style>
</head>
<body>
<div class="full-container">
<form  class="form-horizontal" role="form" id="product-from">
	<div class="page-header text-center ">
	{if condition="!empty($product) && !empty($product['id'])"}
	<h1>{$product['title']}</h1>
	<input type="hidden" name="id" value="{$product['id']}">
	{else /}
	<h1>创建产品</h1>
	{/if}
	</div>
	<div class="row form-group">
		<label for="title" class="col-sm-2 control-label text-right">名称：</label>
		<div class="col-sm-8">
			<input type="text" class="form-control" name="title" placeholder="请输入名称"
			value='{if condition="!empty($product)"}{$product["title"]}{/if}'
			>
		</div>
	</div>
	<div class="row form-group">
		<label for="img_url" class="col-sm-2 control-label text-right">图片地址：</label>
		<div class='col-sm-8'>
			<input type="text" class="form-control" name="img_url" placeholder="图片地址"
			value='{if condition="!empty($product)"}{$product["img_url"]}{/if}'
			>
		</div>
	</div>
	<div class='row form-group {if condition="empty($product)"}hidden{/if}'>
		<label for="img" class="col-sm-2 control-label text-right">图片</label>
		<div class="col-sm-8">
			<img src="{if condition="!empty($product)"}{$product["img_url"]}{/if}"
			width=100 height=100 >
		</div>
	</div>
	<div class="row form-group">
		<label for="short_title" class="col-sm-2 control-label text-right">短标题：</label>
		<div class="col-sm-8">
			<input type="text" class="form-control" name="short_title" placeholder="短标题"
			value='{if condition="!empty($product)"}{$product["short_title"]}{/if}'>
		</div>
	</div>
	<div class="row form-group">
		<label for="category_id" class="col-sm-2 control-label text-right">分类：</label>
		<div class="col-sm-4">
			<select id="selected_category" onchange="categoryChange" class="form-control" >
			{foreach name="categorys" item="category" key="k" }
			  {if condition="$category['parent'] eq 0"}
			  <option value="{$category['id']}" 
			  {if condition="$product && $categorys[$product['category_id']]['parent'] == $k"}selected{/if}
			  >{$category['title']}</option>
			  {/if}
			{/foreach}
			</select>
		</div>
		<div class="col-sm-4">
			<select id="selected_category_id" name="category_id" class="form-control" >

			</select>
		</div>
	</div>
	<div class="row form-group">
		<label for="category_id" class="col-sm-2 control-label text-right">首页展示：</label>
		<div class="col-sm-8">
			<select class="form-control">
			{foreach name="home_arr" item="home" key="k"}
			  <option value="{$k}" {if condition="$ishome == $k"}selected{/if}>{$home}</option>
			{/foreach}
			</select>
		</div>
	</div>
	<div class="row form-group">
        <label for="short_desc" class="col-md-2 control-label text-right">短描述 : </label>
        <div class="col-sm-8">
            <div id="short_desc" name="short_desc">
            	{if condition="!empty($product)"}{$product['short_desc']}{/if}
            </div>
        </div>
    </div>
    <div class="row form-group">
    	<div class="col-sm-1"></div>
    	<div class="col-sm-8">
	    <fieldset id="props">
	    	<legend>规格展示</legend>
			<button type="button" class="btn btn-primary" onclick="addProp()">添加规格</button>
			<hr />
			{if condition="!empty($product)"}
			{foreach name="$product['property']" item="prop" key="k"}
		    <div class="row form-group">
		    	<div class="col-sm-2">
				    <input type="text" class="form-control prop-name" placeholder="属性名字" value="{$k}">
				</div>
				<div class="col-sm-8">
		      		<input type="text" class="form-control prop-content" placeholder="属性内容" value="{$prop}">
		      	</div>
		      	<div class="col-sm-2">
			  		<button type="button" class="btn btn-warning" onclick="delProp(this)">删除规格</button>
			  	</div>
		    </div>
		    {/foreach}
		    {/if}
		</fieldset>
		</div>
		
	</div>
	<hr >
	<div class="row form-group">
		<div class="col-sm-8"></div>
		<div class="col-sm-2">
			<button type="button" class="btn btn-primary" onclick="saveProduct()">保存</button>
			{if condition="!empty($product)"}
			<button type="button" class="btn btn-danger" onclick="delProduct({$product['id']})">删除</button>
			{/if}
		</div>
	</div>
</form>
<br /><br /><br />
<div id="prop-template" class="row form-group hidden">
	<div class="col-sm-2">
	    <input type="text" class="form-control prop-name" placeholder="属性名字">
	</div>
	<div class="col-sm-8">
  		<input type="text" class="form-control prop-content" placeholder="属性内容">
  	</div>
  	<div class="col-sm-2">
  		<button type="button" class="btn btn-warning" onclick="delProp(this)">删除属性</button>
  	</div>
</div>

</div>
<script type="text/javascript">
var categorys = {:json_encode($categorys)};
var initCategoryId = "{$product['category_id']}";

$(document).ready( function(){
	categoryChange() ;
});

function categoryChange() {
	var parent_id = $('#selected_category').val() ;
	$("#selected_category_id").html('');
	for( var idx in categorys ) {
		if( categorys [idx] ['parent'] == parent_id ){
			var isSelected = "";
			if( initCategoryId == categorys [idx] ['id']) {
				isSelected = "selected" ;
			}
			$option = $("<option value='"+categorys [idx] ['id']+"' "+isSelected+" >"+categorys [idx] ['title']+"</option>");
			$("#selected_category_id").append($option);
		}
	}
}
</script>
</body>
</html>